{% extends 'base.html' %}
{% block title %} Step 3 {% endblock %}
{% block content %}
<div class="row">
  <div class="col l6 offset-l3 s12 m8 offset-m2">
    <div class="card-content">
      <ul class="stepper horizontal" id="horizontal">
         <li class="step active">
            <!--data-step-label="To step-title!" -->
            <div class="step-title waves-effect waves-dark">Step 1</div>
         </li>
         <li class="step active">
            <div class="step-title waves-effect waves-dark">Step 2</div>
         </li>
         <li class="step active">
            <div class="step-title waves-effect waves-dark">Step 3</div>
         </li>
      </ul>
    </div>
  </div>
</div>
<div class="row">
  <div class="col offset-s2">
    <h6 class="main-grey-text">How often do you want to check your product for indexation?</h6>
  </div>
  <form id="form" class="col center s8 offset-s2" method="POST" data-save-url="{% url 'products_save_product' %}" >
    {% csrf_token %}
      {% for choice in form.choices_group1 %}
      <p>
        {{ choice.tag }}
        <label for="id_choices_group1_{{ forloop.counter0 }}">{{ choice.choice_label }}</label>
      </p>
      {% endfor %}
      <div>
        <h6 class="main-grey-text left">Do you wish to receive an email each time the report is run automatically?</h6>
      </div>
      <br>
      {% for choice in form.choices_group2 %}
      <p>
        {{ choice.tag }}
        <label for="id_choices_group2_{{ forloop.counter0 }}">{{ choice.choice_label }}</label>
      </p>
      {% endfor %}
      <div style="padding-left: 20px">
        {% for choice in form.choices_group3 %}
        <p>
          {{ choice.tag }}
          <label for="id_choices_group3_{{ forloop.counter0 }}">{{ choice.choice_label }}</label>
        </p>
        {% endfor %}
      </div>
      <a id="save-button" class="btn waves-effect waves-light blue-paypal button-padding">Save Product
      </a>
      <a id="saveAndRun" value="saveAndRun" class="btn waves-effect waves-light blue-paypal">Save and run indexation now</a>
      <div id="loader" class="preloader-wrapper small active" style="display: none; margin-left: 30px;">
   <div class="spinner-layer spinner-blue-only">
     <div class="circle-clipper left">
       <div class="circle"></div>
     </div><div class="gap-patch">
       <div class="circle"></div>
     </div><div class="circle-clipper right">
       <div class="circle"></div>
     </div>
   </div>
      </div>
      {% if form.errors %}
        {% for field in form %}
            {% for error in field.errors %}
                <div class="alert alert-danger">
                    {{field.name}}
                    <strong>{{ error|escape }}</strong>
                </div>
            {% endfor %}
        {% endfor %}
        {% for error in form.non_field_errors %}
            <div class="alert alert-danger">
                {{field.name}}
                <strong>{{ error|escape }}</strong>
            </div>
        {% endfor %}
      {% endif %}
    </form>
  </div>
{% endblock %}
{% load static %}
{% block css %}
<link href="{% static 'css/materialize-stepper.min.css' %}" rel="stylesheet" type="text/css" />
{% endblock %}
{% block js %}
<script type="text/javascript">
  $("#saveAndRun, #save-button").on("click", function (e) {  
    e.preventDefault();
    var idEvent = e.target.id;
    $('#saveAndRun').hide();
    $('#save-button').hide();
    $('#loader').show();

    var form = $('#form');
    $.ajax({
      url: form.attr("data-save-url"),
      type : "POST",
      data: form.serialize() + '&'+idEvent+'='+ 'True',
      dataType: 'json',
      success: function (data) {
        if (data.uuid !== undefined && data.id !== undefined) {
          window.location = '/product/detail/'+data.uuid+'/'+data.id;
        }
        else if (data.saved === true) {
          window.location = '/dashboard';
        }
        else {
          Materialize.toast('Error saving', 3000);
          $('#saveAndRun').show();
          $('#save-button').show();
          $('#loader').hide();

        }
      },
      error: function(request, status, error) {
        console.log(error);
      }
    });

  });
</script>
<script src="{% static 'js/radio_buttons.js' %}"></script>
{% endblock %}